Here’s how assignments and progress work in this app. Use this as the source of truth when generating code.

Core entities

assignments: A task created for an organization (org_id). Created by org owners/managers/staff.
assignment_progress: Tracks a specific user’s completion of a specific assignment. One row per (assignment_id, profile_id), with completed boolean and optional completed_at timestamp.
Access rules (RLS summary)

assignments
Read: Any member of the assignment’s organization.
Write (create/update/delete): Only org owners, managers, or staff.
assignment_progress
Read/Write: A user can read/insert/update only their own rows (profile_id = auth.uid()).
What “incomplete” means

An assignment is incomplete if:
It has no progress rows at all (not started), or
At least one progress row exists with completed = false.
An assignment is complete only if every existing progress row for it has completed = true.
Aggregation logic used today

For an org, compute:
Total assignments.
For each assignment: counts of progress rows, completed rows, incomplete rows.
Incomplete assignments count:
Count DISTINCT assignments where NOT EXISTS any progress OR EXISTS any progress with completed = false.
Targets and completeness nuance

The app supports targeting via assignment_targets (target_type: player/group/team).
If “complete” must mean “all intended recipients finished,” either:
Pre-create one assignment_progress row per expected recipient at assignment creation time, or
At query time, derive the expected recipient set from assignment_targets and compare against completed progress rows.
Current queries consider only existing assignment_progress rows; recipients with no row imply “not started” and keep the assignment incomplete.
Performance/indexing

Ensure indexes on:
assignments(org_id)
assignment_progress(assignment_id), assignment_progress(profile_id)
org_members(org_id, user_id)
group_members(group_id, profile_id)
Example query patterns

Count incomplete assignments in an org:
NOT EXISTS any assignment_progress for the assignment OR EXISTS any with completed = false.
Inspect per-assignment status:
Progress counts and a JSON of per-profile completion flags.
Expected behaviors

Members can see assignments for their org.
Each user can only mark their own progress as complete.
Staff manage assignment lifecycle and targeting.